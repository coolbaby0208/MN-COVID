---
# title: "MN COVID-19 update: `r format(Sys.time(), '%Y-%m-%d')`  by r/coolbaby0208"
output: 
  pdf_document:
    fig_height: 5.5
    fig_width: 6
geometry: margin = 0.25in
papersize: letter
subparagraph: yes
fontsize: 10pt
editor_options: 
  chunk_output_type: console
classoption: twocolumn
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(lubridate)
## call other scripts
source('mdhCovidWebScrape.R')
source('COVID.R')

## get data for the most recent date
dataWidePlain = dataWide %>% 
   filter(Date == last(Date))

dataLongAvgPlain = dataLongAvg %>% 
   filter(Date == last(Date), Variable == "PositivePercent")

dataLongAvgPeople = dataLongAvg %>% 
   filter(Date == last(Date), Variable == "PositivePercentPeoplePlot")
```

## MN COVID-19 Summary (`r format(Sys.time(), '%Y-%m-%d')`)
* Testing
  + Total number of completed tests: **`r (dataWidePlain$Total.tested) %>% formatC(format="d", big.mark=",")`** (up `r (dataWidePlain$Daily.tests) %>% formatC(format="d", big.mark=",")`)
  + Total number of people tested: **`r (dataWidePlain$Total.tested.people) %>% formatC(format="d", big.mark=",")`** (up `r (dataWidePlain$Daily.tests.people) %>% formatC(format="d", big.mark=",")`)
  + Total positive cases: **`r (dataWidePlain$Total.cases) %>% formatC(format="d", big.mark=",")`** (up `r (dataWidePlain$New.cases) %>% formatC(format="d", big.mark=",")`)
  + Daily/7-day positive percentage: **`r (round(dataLongAvgPlain$Value, 4)*100)`/`r (round(dataLongAvgPlain$movAvgValue, 4)*100)`**
  + Daily/7-day positive percentage (people): **`r (round(dataLongAvgPeople$Value, 4)*100)`/`r (round(dataLongAvgPeople$movAvgValue, 4)*100)`**
* Case info   
  + Patients who are currently sick: **`r (dataWidePlain$Currently.sick) %>% formatC(format="d", big.mark=",")`** (`r (ifelse(dataWidePlain$New.sick <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.sick))) %>% formatC(format="d", big.mark=",")`)
  + Total deaths: **`r (dataWidePlain$Total.deaths) %>% formatC(format="d", big.mark=",")`** (`r (ifelse(dataWidePlain$New.deaths <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.deaths)))`)
* Hospitalization   
  + Total hospitalized: **`r (dataWidePlain$Total.Hospital) %>% formatC(format="d", big.mark=",")`** (`r (ifelse(dataWidePlain$New.hospitalized <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.hospitalized))) %>% formatC(format="d", big.mark=",")`)
    - Total ICU: **`r (dataWidePlain$Total.ICU) %>% formatC(format="d", big.mark=",")`** (`r (ifelse(dataWidePlain$New.ICU <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.ICU)))`)

```{r plot1, echo=FALSE, warning = FALSE, message=FALSE}
## plots from COVID.R
p1
```


```{r plot2, echo=FALSE, warning = FALSE, message=FALSE}
## plots from COVID.R
p2
```

   
```{r plot3, echo=FALSE, warning = FALSE, message=FALSE,fig.width = 6}
## plots from COVID.R
p3
```

```{r plot5, echo=FALSE, warning = FALSE, message=FALSE, fig.width = 6, fig.height = 3.5}
## plots from COVID.R
p5
```


```{r plot4, echo=FALSE, warning = FALSE, message=FALSE, fig.width = 6, fig.height = 2.5}
## plots from COVID.R
p4
```

```{r table1, echo=FALSE, warning= FALSE, include = FALSE}
## table 1
 dataWide %>% 
   mutate(Date = format(Date, format = "%b %d"))%>% 
   filter(Date %in% tail(Date, 5)) %>%
   select(-contains("By"),-contains("Plot")) %>% 
   select(Date, starts_with("Total")) %>%
   rename_at(vars(starts_with("Total")), ~str_to_title(str_remove_all(.,"Total."))) %>%
   kable(digits = 3,booktabs = T, caption = "Cumulative numbers for last 5 days",align = "c") %>%
   kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9) %>% 
   row_spec(5, color = "white", background = "#FF33CC") 
```

```{r table2, echo=FALSE, warning= FALSE}
## table 2
 dataWide %>%
   mutate(Date = format(Date, format = "%b %d")) %>% 
   filter(Date %in% tail(Date, 5)) %>%
   select(-starts_with("Total"), -ends_with("Percent"), Daily.tests, Daily.tests.people) %>% 
   rename(`New Hospitalized` = New.hospitalized, `Active` = Currently.sick, `New ICU` = New.ICU, `Tests` = Daily.tests, `People tested` = Daily.tests.people) %>%
   select(Date, `New Hospitalized`, `New ICU`, Active, Tests, `People tested`) %>% 
   mutate_at(vars(`New Hospitalized`:`People tested`), list(~formatC(., format="d", big.mark=","))) %>%
   kable(digits = 2, booktabs = T, caption = "Daily numbers for last 5 days", align = "c") %>%
   kable_styling(latex_options = c("hold_position","scale_down"), font_size = 9) %>% 
   row_spec(5, color = "white", background = "#FF33CC") 
```
For source code and data source please see 

* *https://github.com/coolbaby0208/MN-COVID19*

