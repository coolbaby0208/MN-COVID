---
# title: "MN COVID-19 update: `r format(Sys.time(), '%Y-%m-%d')`  by r/coolbaby0208"
output: 
  pdf_document:
    fig_height: 5.5
    fig_width: 6
geometry: margin = 0.25in
papersize: letter
subparagraph: yes
fontsize: 10pt
editor_options: 
  chunk_output_type: console
classoption: twocolumn
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(lubridate)
## call other scripts
source('mdhCovidWebScrape.R')
source('COVID.R')

## get data for the most recent date
dataWidePlain = dataWide %>% 
   filter(Date == last(Date))

dataLongAvgPlain = dataLongAvg %>% 
   filter(Date == last(Date), Variable == "PositivePercent")
```

## MN COVID-19 Summary (`r format(Sys.time(), '%Y-%m-%d')`)
* Testing
  + Total number of completed tests: **`r (dataWidePlain$Total.tested)`** (up `r (dataWidePlain$Daily.tests)`)
  + Total positive: **`r (dataWidePlain$Total.cases)`** (up `r (dataWidePlain$New.cases)`)
  + Daily/7-day positive percentage: **`r (round(dataLongAvgPlain$Value, 4)*100)`/`r (round(dataLongAvgPlain$movAvgValue, 4)*100)`**
* Case info   
  + Patients who are currently sick: **`r (dataWidePlain$Currently.sick)`** (`r (ifelse(dataWidePlain$New.sick <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.sick)))`)
  + Total deaths: **`r (dataWidePlain$Total.deaths)`** (`r (ifelse(dataWidePlain$New.deaths <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.deaths)))`)
 - Hospitalization   
   - Hospitalized as of today: **`r (dataWidePlain$Currently.hospitalized)`** (`r (ifelse(dataWidePlain$New.hospitalized <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.hospitalized)))`)
     - Hospitalized in ICU as of today: **`r (dataWidePlain$ICU)`** (`r (ifelse(dataWidePlain$New.ICU <0, sprintf("down"), sprintf("up")))` `r (abs((dataWidePlain$New.ICU)))`)

```{r plot1, echo=FALSE, warning = FALSE, message=FALSE}
## plots from COVID.R
p1
```


```{r plot2, echo=FALSE, warning = FALSE, message=FALSE}
## plots from COVID.R
p2
```

   
```{r plot3, echo=FALSE, warning = FALSE, message=FALSE}
## plots from COVID.R
p3
```

```{r plot5, echo=FALSE, warning = FALSE, message=FALSE, fig.width = 6, fig.height = 3.5}
## plots from COVID.R
p5
```


```{r plot4, echo=FALSE, warning = FALSE, message=FALSE, fig.width = 6, fig.height = 2.5}
## plots from COVID.R
p4
```

```{r table1, echo=FALSE, warning= FALSE, include = FALSE}
## table 1
 dataWide %>% 
   mutate(Date = format(Date, format = "%b %d"))%>% 
   filter(Date %in% tail(Date, 5)) %>%
   select(-contains("By"),-contains("Plot")) %>% 
   select(Date, starts_with("Total")) %>%
   rename_at(vars(starts_with("Total")), ~str_to_title(str_remove_all(.,"Total."))) %>%
   kable(digits = 3,booktabs = T, caption = "Cumulative numbers for last 5 days",align = "c") %>%
   kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9) %>% 
   row_spec(5, color = "white", background = "#FF33CC") 
```

```{r table2, echo=FALSE, warning= FALSE}
## table 2
 dataWide %>%
   mutate(Date = format(Date, format = "%b %d")) %>% 
   filter(Date %in% tail(Date, 5)) %>%
   #mutate(HospitalizedPercent = HospitalizedPercent*100, ICUPercent = ICUPercent*100) %>%
   select(-starts_with("Total"), -starts_with("New"), -ends_with("Percent"), Daily.tests) %>% 
   rename(`Hospitalized` = Currently.hospitalized, `Active` = Currently.sick, `ICU` = ICU, `Tests` = Daily.tests) %>%
   select(Date, Hospitalized, ICU, Active, Tests) %>% 
   kable(digits = 2, booktabs = T, caption = "Current numbers for last 5 days", align = "c") %>%
   kable_styling(latex_options = c("hold_position","scale_down"), font_size = 9) %>% 
   row_spec(5, color = "white", background = "#FF33CC") 
```
For source code and data source please see 

* *https://github.com/coolbaby0208/MN-COVID19*

